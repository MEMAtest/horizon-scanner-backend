function renderImmediateDefinitionsSection() {
  return "        // =================\n        // IMMEDIATE DEFINITIONS - Prevent HTML onclick errors\n        // =================\n        \n        function parseDate(value) {\n            if (!value) return null;\n            const date = new Date(value);\n            return isNaN(date) ? null : date;\n        }\n\n        function formatDateDisplay(value) {\n            const date = parseDate(value);\n            if (!date) return 'Unknown';\n            return date.toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' });\n        }\n\n        function truncateText(text, maxLength = 200) {\n            if (!text) return '';\n            const trimmed = text.trim();\n            if (trimmed.length <= maxLength) return trimmed;\n            return trimmed.substring(0, maxLength).trim() + '...';\n        }\n\n        function escapeHtml(value) {\n            return String(value ?? '')\n                .replace(/&/g, '&amp;')\n                .replace(/</g, '&lt;')\n                .replace(/>/g, '&gt;')\n                .replace(/\"/g, '&quot;')\n                .replace(/'/g, '&#39;');\n        }\n\n        function escapeAttribute(value) {\n            return String(value ?? '')\n                .replace(/&/g, '&amp;')\n                .replace(/</g, '&lt;')\n                .replace(/>/g, '&gt;')\n                .replace(/\"/g, '&quot;')\n                .replace(/'/g, '&#39;');\n        }\n\n        function getSectorAliasMap() {\n            const map = window.__sectorAliasMap;\n            return map && typeof map === 'object' ? map : {};\n        }\n\n        function normalizeSectorLabel(value) {\n            if (value == null) return '';\n            const raw = String(value).trim();\n            if (!raw) return '';\n            const key = raw.toLowerCase().replace(/[^a-z0-9]/g, '');\n            const aliasMap = getSectorAliasMap();\n            return aliasMap[key] || raw;\n        }\n\n        function isFallbackSummary(summary = '') {\n            const normalized = summary.trim().toLowerCase();\n            return normalized.startsWith('informational regulatory update') ||\n                   normalized.startsWith('significant regulatory development') ||\n                   normalized.startsWith('regulatory update') ||\n                   normalized.startsWith('regulatory impact overview') ||\n                   normalized === 'summary not available' ||\n                   normalized === 'no summary available' ||\n                   normalized.includes('summary not available') ||\n                   normalized.includes('no summary available');\n        }\n        // Define critical functions immediately\n        window.updateLiveCounters = function() {\n            console.log('[refresh] Updating live counters...');\n            \n            fetch('/api/stats/live')\n                .then(response => response.json())\n                .then(data => {\n                    if (data.success) {\n                        const elements = {\n                            'totalUpdates': data.stats?.totalUpdates || 0,\n                            'newCount': data.stats?.newToday || 0,\n                            'urgentCount': data.stats?.urgent || 0,\n                            'moderateCount': data.stats?.moderate || 0,\n                            'backgroundCount': data.stats?.background || 0\n                        };\n                        \n                        Object.entries(elements).forEach(([id, value]) => {\n                            const element = document.getElementById(id);\n                            if (element) element.textContent = value;\n                        });\n                        \n                        const lastUpdateEl = document.getElementById('lastUpdate');\n                        if (lastUpdateEl) {\n                            lastUpdateEl.textContent = 'Last: ' + new Date().toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });\n                        }\n                    }\n                })\n                .catch(error => console.warn('Counter update failed:', error));\n        };\n        \n        window.refreshData = async function() {\n            console.log('[refresh] Refresh data called');\n\n            const btn = event?.target || document.getElementById('refreshBtn');\n            if (btn) btn.disabled = true;\n\n            try {\n                const response = await fetch('/api/refresh', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' }\n                });\n\n                const result = await response.json();\n\n                if (result.success) {\n                    showMessage('Refreshed! ' + (result.newArticles || 0) + ' new updates found.', 'success');\n                    setTimeout(() => window.location.reload(), 1000);\n                } else {\n                    showMessage('Refresh failed: ' + (result.error || 'Unknown error'), 'error');\n                }\n            } catch (error) {\n                console.error('Refresh error:', error);\n                showMessage('Refresh failed: ' + error.message, 'error');\n            } finally {\n                if (btn) btn.disabled = false;\n            }\n        };\n\n        function ensureFilterState() {\n            if (!window.currentFilters || typeof window.currentFilters !== 'object') {\n                window.currentFilters = { category: 'all', sort: 'newest' };\n            }\n            if (!window.currentFilters.category) {\n                window.currentFilters.category = 'all';\n            }\n            if (!window.currentFilters.sort) {\n                window.currentFilters.sort = 'newest';\n            }\n            return window.currentFilters;\n        }\n\n        function formatFilterLabel(value) {\n            if (!value) return '';\n            return String(value)\n                .replace(/[-_]/g, ' ')\n                .replace(/\b([a-zA-Z])/g, char => char.toUpperCase());\n        }\n\n        function hasActiveNonCategoryFilters(filters) {\n            return Boolean(\n                filters.authority ||\n                filters.sector ||\n                filters.impact ||\n                filters.urgency ||\n                filters.range ||\n                filters.search\n            );\n        }\n\n        async function filterByCategory(category) {\n            console.log('Filtering by category:', category);\n            try {\n                let filters = ensureFilterState();\n                const previousSort = filters.sort || 'newest';\n\n                if (hasActiveNonCategoryFilters(filters)) {\n                    clearAllFilters({ preserveSort: true, silent: true, skipApply: true });\n                    filters = ensureFilterState();\n                    filters.sort = previousSort;\n                    showMessage('Other filters cleared to apply quick category.', 'info');\n                }\n\n                filters.category = category || 'all';\n\n                await applyCurrentFilters();\n\n                const normalized = (filters.category || 'all').toLowerCase();\n                const message = normalized === 'all'\n                    ? 'Showing all updates'\n                    : 'Filtered to ' + formatFilterLabel(filters.category) + ' updates';\n                showMessage(message, 'info');\n            } catch (error) {\n                console.error('Filter error:', error);\n                showMessage('Filter failed', 'error');\n            }\n        }\n\n        async function filterByAuthority(authority) {\n            console.log('Filtering by authority:', authority);\n            try {\n                const filters = ensureFilterState();\n                if (authority) {\n                    filters.authority = authority;\n                } else {\n                    delete filters.authority;\n                }\n\n                await applyCurrentFilters();\n\n                showMessage(authority ? 'Showing ' + authority + ' updates' : 'Showing all authorities', 'info');\n            } catch (error) {\n                console.error('Authority filter error:', error);\n                showMessage('Authority filter failed', 'error');\n            }\n        }\n\n        async function filterBySector(sector) {\n            console.log('Filtering by sector:', sector);\n            try {\n                const filters = ensureFilterState();\n                if (sector) {\n                    filters.sector = sector;\n                } else {\n                    delete filters.sector;\n                }\n\n                await applyCurrentFilters();\n\n                showMessage(sector ? 'Showing ' + sector + ' updates' : 'Showing all sectors', 'info');\n            } catch (error) {\n                console.error('Sector filter error:', error);\n                showMessage('Sector filter failed', 'error');\n            }\n        }\n\n        async function filterByImpactLevel(impact) {\n            console.log('Filtering by impact level:', impact);\n            try {\n                const filters = ensureFilterState();\n                if (impact) {\n                    filters.impact = impact;\n                } else {\n                    delete filters.impact;\n                }\n\n                await applyCurrentFilters();\n\n                showMessage(impact ? 'Showing ' + impact + ' impact updates' : 'Showing all impact levels', 'info');\n            } catch (error) {\n                console.error('Impact filter error:', error);\n                showMessage('Impact filter failed', 'error');\n            }\n        }\n\n        async function filterByDateRange(range) {\n            console.log('Filtering by date range:', range);\n            try {\n                const filters = ensureFilterState();\n                if (range) {\n                    filters.range = range;\n                } else {\n                    delete filters.range;\n                }\n\n                await applyCurrentFilters();\n\n                const labelMap = {\n                    today: 'today',\n                    week: 'this week',\n                    'this-week': 'this week',\n                    month: 'this month',\n                    quarter: 'this quarter'\n                };\n                const normalized = (range || '').toLowerCase();\n                const message = range\n                    ? 'Showing updates from ' + (labelMap[normalized] || formatFilterLabel(range))\n                    : 'Showing all time periods';\n                showMessage(message, 'info');\n            } catch (error) {\n                console.error('Date filter error:', error);\n                showMessage('Date range filter failed', 'error');\n            }\n        }\n\n        async function filterByUrgency(urgency) {\n            console.log('Filtering by urgency:', urgency);\n            try {\n                const filters = ensureFilterState();\n                if (urgency) {\n                    filters.urgency = urgency;\n                } else {\n                    delete filters.urgency;\n                }\n\n                await applyCurrentFilters();\n\n                showMessage(urgency ? 'Showing ' + urgency + ' urgency updates' : 'Showing all urgency levels', 'info');\n            } catch (error) {\n                console.error('Urgency filter error:', error);\n                showMessage('Urgency filter failed', 'error');\n            }\n        }\n        \n        // Analytics refresh function\n        window.refreshAnalytics = async function() {\n            console.log('[analytics] Refreshing analytics...');\n\n            const btn = event?.target;\n            if (btn) {\n                btn.disabled = true;\n                btn.textContent = '[refresh] Refreshing...';\n            }\n\n            try {\n                // Call analytics refresh endpoint (if it exists) or just reload\n                showMessage('Analytics refreshed successfully', 'success');\n                setTimeout(() => window.location.reload(), 1000);\n            } catch (error) {\n                console.error('Analytics refresh error:', error);\n                showMessage('Failed to refresh analytics: ' + error.message, 'error');\n            } finally {\n                if (btn) {\n                    btn.disabled = false;\n                    btn.textContent = '[refresh] Refresh Analytics';\n                }\n            }\n        };\n        \n        window.showMessage = function(message, type = 'info') {\n            console.log(type.toUpperCase() + ': ' + message);\n            \n            const toast = document.createElement('div');\n            const bgColor = type === 'error' ? '#fef2f2' : type === 'success' ? '#f0fdf4' : type === 'warning' ? '#fffbeb' : '#f0f9ff';\n            const textColor = type === 'error' ? '#dc2626' : type === 'success' ? '#059669' : type === 'warning' ? '#d97706' : '#2563eb';\n            \n            toast.style.cssText =\n                'position: fixed;' +\n                'top: 20px;' +\n                'right: 20px;' +\n                'background: ' + bgColor + ';' +\n                'color: ' + textColor + ';' +\n                'padding: 12px 16px;' +\n                'border-radius: 8px;' +\n                'border: 1px solid ' + textColor + '33;' +\n                'font-size: 14px;' +\n                'z-index: 10000;' +\n                'max-width: 350px;' +\n                'box-shadow: 0 4px 6px rgba(0,0,0,0.1);' +\n                'animation: slideIn 0.3s ease;';\n            toast.textContent = message;\n            \n            document.body.appendChild(toast);\n            \n            setTimeout(() => {\n                if (toast.parentNode) {\n                    toast.style.animation = 'slideOut 0.3s ease';\n                    setTimeout(() => {\n                        if (toast.parentNode) toast.parentNode.removeChild(toast);\n                    }, 300);\n                }\n            }, 4000);\n        };\n        ";
}

module.exports = {
  renderImmediateDefinitionsSection
}
