function renderExposureSection() {
  return "        // CREATE FILTER MODULE\n        // =================\n        \n        // Create FilterModule object to expose all filter functions\n        window.FilterModule = {\n            filterByCategory,\n            filterByAuthority,\n            filterBySector,\n            filterByImpactLevel,\n            filterByDateRange,\n            filterByUrgency,\n            sortUpdates,\n            loadMoreUpdates,\n            clearAllFilters,\n            clearFilters,\n            applyActiveFilters,\n            applyCurrentFilters,\n            async applyFilters(filterParams = {}) {\n                const filters = ensureFilterState();\n                delete filters.specialView;\n\n                const setFromValues = (setRef, values) => {\n                    setRef.clear();\n                    values.forEach(value => setRef.add(value));\n                };\n\n                const authorityValues = normalizeFilterValues(filterParams.authority);\n                if (authorityValues.length > 0) {\n                    filters.authority = authorityValues.join(',');\n                    setFromValues(selectedAuthorities, authorityValues);\n                } else {\n                    delete filters.authority;\n                    selectedAuthorities.clear();\n                }\n\n                const impactValues = normalizeFilterValues(filterParams.impact);\n                if (impactValues.length > 0) {\n                    filters.impact = impactValues.join(',');\n                    setFromValues(selectedImpactLevels, impactValues);\n                } else {\n                    delete filters.impact;\n                    selectedImpactLevels.clear();\n                }\n\n                const urgencyValues = normalizeFilterValues(filterParams.urgency);\n                if (urgencyValues.length > 0) {\n                    filters.urgency = urgencyValues.join(',');\n                    setFromValues(selectedUrgencies, urgencyValues);\n                } else {\n                    delete filters.urgency;\n                    selectedUrgencies.clear();\n                }\n\n                const sectorValues = normalizeFilterValues(filterParams.sector);\n                if (sectorValues.length > 0) {\n                    filters.sector = sectorValues.join(',');\n                } else {\n                    delete filters.sector;\n                }\n\n                const rangeValues = normalizeFilterValues(filterParams.range);\n                if (rangeValues.length > 0) {\n                    filters.range = rangeValues[0];\n                } else {\n                    delete filters.range;\n                }\n\n                if (filterParams.search != null && String(filterParams.search).trim() !== '') {\n                    filters.search = String(filterParams.search).trim();\n                } else {\n                    delete filters.search;\n                }\n\n                if (filterParams.category != null && String(filterParams.category).trim() !== '') {\n                    filters.category = String(filterParams.category).trim();\n                } else {\n                    filters.category = 'all';\n                }\n\n                if (filterParams.sort != null && String(filterParams.sort).trim() !== '') {\n                    filters.sort = String(filterParams.sort).trim();\n                } else {\n                    filters.sort = 'newest';\n                }\n\n                const searchInput = document.getElementById('search-input') || document.getElementById('searchBox');\n                if (searchInput) {\n                    searchInput.value = filters.search || '';\n                }\n\n                const authoritySelect = document.querySelector('select[onchange*=\"filterByAuthority\"]');\n                if (authoritySelect) {\n                    authoritySelect.value = authorityValues[0] || '';\n                }\n\n                const sectorSelect = document.querySelector('select[onchange*=\"filterBySector\"]');\n                if (sectorSelect) {\n                    sectorSelect.value = sectorValues[0] || '';\n                }\n\n                const impactSelect = document.querySelector('select[onchange*=\"filterByImpactLevel\"]');\n                if (impactSelect) {\n                    impactSelect.value = impactValues[0] || '';\n                }\n\n                const rangeSelect = document.querySelector('select[onchange*=\"filterByDateRange\"]');\n                if (rangeSelect) {\n                    rangeSelect.value = rangeValues[0] || '';\n                }\n\n                document.querySelectorAll('.authority-checkbox').forEach(cb => {\n                    cb.checked = authorityValues.includes(cb.value);\n                });\n\n                document.querySelectorAll('.impact-checkbox').forEach(cb => {\n                    cb.checked = impactValues.includes(cb.value);\n                });\n\n                document.querySelectorAll('.urgency-checkbox').forEach(cb => {\n                    cb.checked = urgencyValues.includes(cb.value);\n                });\n\n                await applyCurrentFilters();\n            },\n            async applyFilter(filterName) {\n                if (!filterName) {\n                    await applyCurrentFilters();\n                    return;\n                }\n\n                if (filterName === 'pinned') {\n                    await synchronizePinnedState({ silent: true });\n                    const filters = ensureFilterState();\n                    filters.specialView = 'pinned';\n                    const pinnedSet = new Set(Array.from(pinnedUrls).map(value => String(value)));\n                    const pinnedUpdates = originalUpdates.filter(update => pinnedSet.has(String(update.id)) || pinnedSet.has(update.url));\n\n                    if (pinnedUpdates.length === 0) {\n                        showMessage('No pinned updates yet', 'warning');\n                    } else {\n                        showMessage('Showing pinned updates', 'info');\n                    }\n\n                    renderUpdatesList(pinnedUpdates);\n                    return;\n                }\n\n                const filters = ensureFilterState();\n                delete filters.specialView;\n                await filterByCategory(filterName);\n            },\n            getCurrentFilters() {\n                const filters = ensureFilterState();\n                return {\n                    category: filters.category,\n                    authority: filters.authority || null,\n                    sector: filters.sector || null,\n                    impact: filters.impact || null,\n                    urgency: filters.urgency || null,\n                    range: filters.range || null,\n                    search: filters.search || null,\n                    sort: filters.sort || 'newest'\n                };\n            }\n        };\n\n        if (typeof window.__flushFilterQueue === 'function') {\n            try {\n                const result = window.__flushFilterQueue();\n                if (result && typeof result.then === 'function') {\n                    result.catch(error => console.error('Queued filter flush failed:', error));\n                }\n            } catch (error) {\n                console.error('Failed to flush queued filter calls:', error);\n            }\n        }\n\n        if (typeof window.dispatchEvent === 'function') {\n            try {\n                window.dispatchEvent(new Event('dashboard:filters-ready'));\n            } catch (error) {\n                console.error('Failed to dispatch filters-ready event:', error);\n            }\n        }\n\n        // Also expose functions globally for backward compatibility\n        window.filterByCategory = filterByCategory;\n        window.filterByAuthority = filterByAuthority;\n        window.filterBySector = filterBySector;\n        window.filterByImpactLevel = filterByImpactLevel;\n        window.filterByDateRange = filterByDateRange;\n        window.filterByUrgency = filterByUrgency;\n        window.sortUpdates = sortUpdates;\n        window.loadMoreUpdates = loadMoreUpdates;\n        window.clearAllFilters = clearAllFilters;\n        window.clearFilters = clearFilters;\n        \n        // =================\n        // EXPOSE ALL FUNCTIONS TO WINDOW\n        // =================\n        \n        // Core functions\n        window.refreshIntelligence = refreshIntelligence;\n        window.loadIntelligenceStreams = loadIntelligenceStreams;\n        window.loadAnalyticsPreview = loadAnalyticsPreview;\n        window.checkLiveSubscriptions = checkLiveSubscriptions;\n        window.initializeFilters = initializeFilters;\n        window.generateRelevanceBasedStreams = generateRelevanceBasedStreams;\n        window.generateStream = generateStream;\n        window.generateUpdateCard = generateUpdateCard;\n        window.toggleStreamExpansion = toggleStreamExpansion;\n        window.viewUpdateDetails = viewUpdateDetails;\n        if (typeof togglePin === 'function') {\n            window.togglePin = togglePin;\n        }\n        window.updateWorkspaceCounts = updateWorkspaceCounts;\n        window.updateAnalyticsPreview = updateAnalyticsPreview;\n        window.applyActiveFilters = applyActiveFilters;\n        window.applyCurrentFilters = applyCurrentFilters;\n        window.checkSystemStatus = checkSystemStatus;\n        window.initializeSystem = initializeSystem;\n        window.renderPriorityHighlights = renderPriorityHighlights;\n        const ReportModule = (function() {\n            async function exportReport(type, filters = {}) {\n                const trigger = (window.event && window.event.target instanceof HTMLElement) ? window.event.target : null;\n                if (trigger) trigger.disabled = true;\n\n                try {\n                    showMessage('Generating report export...', 'info');\n\n                    const response = await fetch('/api/reports', {\n                        method: 'POST',\n                        headers: { 'Content-Type': 'application/json' },\n                        body: JSON.stringify({ report_type: type, filters })\n                    });\n\n                    const payload = await response.json().catch(() => ({}));\n\n                    if (!response.ok || !payload.success) {\n                        throw new Error(payload.error || 'Report export failed');\n                    }\n\n                    const html = payload.report?.html;\n                    if (!html) {\n                        throw new Error('Report response missing HTML content');\n                    }\n\n                    const blob = new Blob([html], { type: 'text/html' });\n                    const url = URL.createObjectURL(blob);\n                    const link = document.createElement('a');\n                    const baseName = (payload.report?.title || type)\n                        .replace(/[^a-z0-9]+/gi, '-')\n                        .replace(/^-+|-+$/g, '')\n                        .toLowerCase();\n                    const reportId = (payload.report && payload.report.id) || 'export';\n\n                    link.href = url;\n                    link.download = (baseName || 'report') + '-' + reportId + '.html';\n                    document.body.appendChild(link);\n                    link.click();\n                    document.body.removeChild(link);\n                    setTimeout(() => URL.revokeObjectURL(url), 1000);\n\n                    showMessage('Report export ready. Download started.', 'success');\n                } catch (error) {\n                    console.error('Report export error:', error);\n                    showMessage('Report export failed: ' + error.message, 'error');\n                } finally {\n                    if (trigger) trigger.disabled = false;\n                }\n            }\n\n            return { exportReport };\n        })();\n\n        window.ReportModule = ReportModule;\n\n        // Update action functions\n        window.viewDetails = viewDetails;\n        window.bookmarkUpdate = bookmarkUpdate;\n        window.shareUpdate = shareUpdate;\n        window.loadMoreUpdates = loadMoreUpdates;\n        window.performSearch = performSearch;\n        window.setupSearchBox = setupSearchBox;\n        \n        // View switching functions\n        window.initializeViewSwitching = initializeViewSwitching;\n        window.switchView = switchView;\n        window.renderUpdatesInView = renderUpdatesInView;\n        window.renderCardsView = renderCardsView;\n        window.renderTableView = renderTableView;\n        window.renderTimelineView = renderTimelineView;\n        window.PriorityModule = {\n            toggleDetails: togglePriorityDetails,\n            handleAction: handlePriorityAction\n        };\n\n        // =================\n        // START INITIALIZATION\n        // =================\n\n        document.addEventListener('DOMContentLoaded', function() {\n            initializeSystem();\n            initializeViewSwitching();\n        });\n\n        console.log('[OK] Client scripts loaded with unified filter functions');";
}

module.exports = {
  renderExposureSection
}
